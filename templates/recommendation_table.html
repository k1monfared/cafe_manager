<!-- Reusable Purchase Recommendations Table -->
<!-- Usage: {% include 'recommendation_table.html' %} -->
<!-- Expects 'recommendations' variable to be passed in context -->

<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th><i class="bi bi-box"></i> Item</th>
                <th><i class="bi bi-cart-plus"></i> Order Quantity</th>
                <th><i class="bi bi-exclamation-triangle"></i> Urgency</th>
                <th><i class="bi bi-clock"></i> Days Remaining</th>
                <th><i class="bi bi-graph-down"></i> Current Stock</th>
                <th><i class="bi bi-speedometer2"></i> Daily Usage</th>
                <th><i class="bi bi-info-circle"></i> Reason</th>
                <th><i class="bi bi-list-ul"></i> Details</th>
            </tr>
        </thead>
        <tbody>
            {% for rec in recommendations %}
            <tr class="table-{{ 'danger' if rec.Urgency == 'CRITICAL' else 'warning' if rec.Urgency == 'HIGH' else 'info' }}">
                <td><strong>{{ rec.Item_Name }}</strong></td>
                <td><strong>{{ "%.1f"|format(rec.Recommended_Quantity) }} {{ rec.Unit }}</strong></td>
                <td><span class="badge bg-{{ 'danger' if rec.Urgency == 'CRITICAL' else 'warning' if rec.Urgency == 'HIGH' else 'secondary' }}">{{ rec.Urgency }}</span></td>
                <td>{{ "%.1f"|format(rec.Days_Remaining) }} days</td>
                <td>{{ "%.1f"|format(rec.Current_Stock) }} {{ rec.Unit }}</td>
                <td>{{ "%.1f"|format(rec.Avg_Daily_Usage) }} {{ rec.Unit }}/day</td>
                <td><small>{{ rec.Urgency_Reason }}</small></td>
                <td>
                    <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#details-{{ rec.Item_Name|replace(' ', '_') }}" aria-expanded="false">
                        <i class="bi bi-info-circle"></i> Details
                    </button>
                </td>
            </tr>
            <tr>
                <td colspan="8" class="p-0">
                    <div class="collapse" id="details-{{ rec.Item_Name|replace(' ', '_') }}">
                        <div class="card card-body m-2">
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="text-primary mb-3">Detailed Calculation Explanation</h6>
                                    <pre class="bg-light p-3 rounded small">{{ rec.Detailed_Explanation }}</pre>
                                </div>
                                <div class="col-md-4">
                                    <h6 class="text-muted mb-3">Summary</h6>
                                    <ul class="list-unstyled small">
                                        <li><strong>Target Stock:</strong> {{ "%.1f"|format(rec.Target_Stock_Level) }} {{ rec.Unit }}</li>
                                        <li><strong>Lead Time:</strong> {{ rec.Lead_Time_Days }} days</li>
                                        <li><strong>Daily Usage:</strong> {{ "%.1f"|format(rec.Avg_Daily_Usage) }} {{ rec.Unit }}/day</li>
                                        <li><strong>Generated:</strong> {{ rec.Generated_Date }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>